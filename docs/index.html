<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Track estimation using YAPS (Yet Another Positioning Solver) • yaps</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Track estimation using YAPS (Yet Another Positioning Solver)">
<meta property="og:description" content="Estimate track from acoustic data using YAPS (doi:10.1038/s41598-017-14278-z).">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">yaps</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0.9110</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/baktoft/yaps/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="yaps---yet-another-positioning-solver" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#yaps---yet-another-positioning-solver" class="anchor"></a>YAPS - (Yet Another Positioning Solver)</h1></div>
<p>Welcome to the <code>yaps</code> repository. The <code>yaps</code> package is based on the original YAPS presented in Baktoft, Gjelland, Økland &amp; Thygesen (2017): <a href="https://www.nature.com/articles/s41598-017-14278-z.pdf">Positioning of aquatic animals based on time-of-arrival and random walk models using YAPS (Yet Another Positioning Solver)</a></p>
<p>To use <code>yaps</code> on own data, you need to compile a TOA-matrix based on synchronized hydrophone data and replace the hydros dataframe with actual hydrophone positions. A complete step-by-step guide on how to do this, can be found in our pre-print paper <a href="https://www.biorxiv.org/content/10.1101/2019.12.16.877688v1">Opening the black box of fish tracking using acoustic telemetry</a>. The example in this guide is based on data collected using a 69 kHz PPM-based system (Vemco VR2). We are working towards adding examples based on data collected using other manufacturers.</p>
<p>For an alternative approach (in python) to prepare your data for <code>yaps</code>, have a look at Jenna Vergeynst’s github repos <a href="https://github.com/JennaVergeynst/time_synchronization">time_synchronization</a> and <a href="https://github.com/JennaVergeynst/prepare_toa_for_yaps">prepare_toa_for_yaps</a>.</p>
<p>The <code>yaps</code> package requires <a href="https://cran.r-project.org/web/packages/devtools/index.html">devtools</a> and <a href="https://github.com/kaskr/adcomp">TMB</a>.<br>
Please see for <a href="https://github.com/kaskr/adcomp/wiki/Download">instructions</a> on TMB installation. Remember to install <a href="https://cran.r-project.org/bin/windows/Rtools/">Rtools</a> as specified in the TMB documentation.</p>
<div id="disclaimer" class="section level2">
<h2 class="hasAnchor">
<a href="#disclaimer" class="anchor"></a>Disclaimer</h2>
<p><strong><code>yaps</code> obeys the fundamental rule of “garbage in, garbage out”. Therefore, DO NOT expect <code>yaps</code> to salvage a poorly designed study, nor to turn crappy data into gold.</strong><br>
We have attempted to make both synchronization process and track estimation user-friendly. However, it is not trivial to synchronize hydrophones (let alone automating the process) based on detections in a variable and often noisy environment. Hydrophones might be replaced/shifted and if not fixed securely, hydrophones might move/be moved during a study. Additionally, hydrophone performance and output format varies considerably among (and within) manufacturers. On top of that, hydrophones don’t always behave and perform as expected. For instance, some hydrophone models autonomously initiate reboots causing perturbation of varying magnitude and/or duration of the internal clock at apparently random time intervals. Therefore, the functions in <code>yaps</code> might perform sub-optimal or even fail miserably when applied to new data. If/when this happens, please let us know through a direct message or leave a bug-report. Also note, the to-do list for improvements and tweaks is long and growing, so stay tuned for updates.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Make sure you have the newest version of <code>yaps</code> installed. For this, you need <code>devtools</code> installed - if not already installed, run <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages('devtools')</a></code>.<br><code>yaps</code> relies heavily on use of Template Model Builder <a href="https://github.com/kaskr/adcomp">TMB</a> for fitting the models, so make sure <code>TMB</code> is installed and working by following the simple <a href="https://github.com/kaskr/adcomp/wiki/Download">TMB instructions</a>.<br>
Then install the latest version of <code>yaps</code> with:</p>
<div class="sourceCode" id="cb1"><pre class="r">    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"TMB"</span>)
    <span class="kw pkg">TMB</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/TMB/man/runExample.html">runExample</a></span>(<span class="kw">all</span><span class="kw">=</span><span class="fl">TRUE</span>)
    <span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"baktoft/yaps"</span>)</pre></div>
</div>
<div id="processing-example-data-ssu1" class="section level2">
<h2 class="hasAnchor">
<a href="#processing-example-data-ssu1" class="anchor"></a>Processing example data ssu1</h2>
<p>The code below is identical to the example workflow presented in <a href="https://www.biorxiv.org/content/10.1101/2019.12.16.877688v1">Opening the black box of fish tracking using acoustic telemetry</a>. See the pre-print for further explantion.</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">yaps</span>)

<span class="co"># set sync parameters </span>
<span class="no">max_epo_diff</span> <span class="kw">&lt;-</span> <span class="fl">120</span>
<span class="no">min_hydros</span> <span class="kw">&lt;-</span> <span class="fl">2</span>
<span class="no">time_keeper_idx</span> <span class="kw">&lt;-</span> <span class="fl">5</span>
<span class="no">fixed_hydros_idx</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>:<span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">11</span>, <span class="fl">13</span>:<span class="fl">17</span>)
<span class="no">n_offset_day</span> <span class="kw">&lt;-</span> <span class="fl">2</span>
<span class="no">n_ss_day</span> <span class="kw">&lt;-</span> <span class="fl">2</span>

<span class="co"># get input data ready for getSyncModel()</span>
<span class="no">inp_sync</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/getInpSync.html">getInpSync</a></span>(<span class="kw">sync_dat</span><span class="kw">=</span><span class="no">ssu1</span>, <span class="no">max_epo_diff</span>, <span class="no">min_hydros</span>, <span class="no">time_keeper_idx</span>,
    <span class="no">fixed_hydros_idx</span>, <span class="no">n_offset_day</span>, <span class="no">n_ss_day</span>)

<span class="co"># fit the sync model</span>
<span class="no">sync_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/getSyncModel.html">getSyncModel</a></span>(<span class="no">inp_sync</span>, <span class="kw">silent</span><span class="kw">=</span><span class="fl">TRUE</span>)

<span class="co"># Plot model residuals and model check plots to ensure the synchronization process was successful...</span>
<span class="fu"><a href="reference/plotSyncModelResids.html">plotSyncModelResids</a></span>(<span class="no">sync_model</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">'overall'</span>)
<span class="fu"><a href="reference/plotSyncModelResids.html">plotSyncModelResids</a></span>(<span class="no">sync_model</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">'sync_tag'</span>)
<span class="fu"><a href="reference/plotSyncModelResids.html">plotSyncModelResids</a></span>(<span class="no">sync_model</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">'hydro'</span>)

<span class="fu"><a href="reference/plotSyncModelCheck.html">plotSyncModelCheck</a></span>(<span class="no">sync_model</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">"sync_bin_sync"</span>)
<span class="fu"><a href="reference/plotSyncModelCheck.html">plotSyncModelCheck</a></span>(<span class="no">sync_model</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">"sync_bin_hydro"</span>)
<span class="fu"><a href="reference/plotSyncModelCheck.html">plotSyncModelCheck</a></span>(<span class="no">sync_model</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">"sync_tag"</span>)
<span class="fu"><a href="reference/plotSyncModelCheck.html">plotSyncModelCheck</a></span>(<span class="no">sync_model</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">"hydro"</span>)

<span class="co"># Apply the synchronization model to all data</span>
<span class="no">detections_synced</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/applySync.html">applySync</a></span>(<span class="kw">toa</span><span class="kw">=</span><span class="no">ssu1</span>$<span class="no">detections</span>, <span class="kw">hydros</span><span class="kw">=</span><span class="no">ssu1</span>$<span class="no">hydros</span>, <span class="no">sync_model</span>)

<span class="co"># Prepare to estimate track using `yaps` on newly synchronized `ssu1` data</span>
<span class="no">hydros_yaps</span> <span class="kw">&lt;-</span> <span class="kw pkg">data.table</span><span class="kw ns">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span>(<span class="no">sync_model</span>$<span class="no">pl</span>$<span class="no">TRUE_H</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">hydros_yaps</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'hx'</span>,<span class="st">'hy'</span>,<span class="st">'hz'</span>)

<span class="co"># Specify focal tag and tag specific min and max burst intervals</span>
<span class="no">focal_tag</span> <span class="kw">&lt;-</span> <span class="fl">15266</span>
<span class="no">rbi_min</span> <span class="kw">&lt;-</span> <span class="fl">20</span>
<span class="no">rbi_max</span> <span class="kw">&lt;-</span> <span class="fl">40</span>

<span class="co"># Extract relevant data from the synced data</span>
<span class="no">synced_dat_ssu1</span> <span class="kw">&lt;-</span> <span class="no">detections_synced</span>[<span class="no">tag</span> <span class="kw">==</span> <span class="no">focal_tag</span>]

<span class="co"># Compile TOA-matrix to use for yaps</span>
<span class="no">toa_ssu1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/getToaYaps.html">getToaYaps</a></span>(<span class="no">synced_dat_ssu1</span>, <span class="no">hydros_yaps</span>, <span class="no">rbi_min</span>, <span class="no">rbi_max</span>)

<span class="co"># Compile all input data needed for yaps</span>
<span class="no">inp_ssu1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/getInp.html">getInp</a></span>(<span class="no">hydros_yaps</span>, <span class="no">toa_ssu1</span>, <span class="kw">E_dist</span><span class="kw">=</span><span class="st">"Mixture"</span>, <span class="kw">n_ss</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">pingType</span><span class="kw">=</span><span class="st">"rbi"</span>,
    <span class="kw">sdInits</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">rbi_min</span><span class="kw">=</span><span class="no">rbi_min</span>, <span class="kw">rbi_max</span><span class="kw">=</span><span class="no">rbi_max</span>, <span class="kw">ss_data_what</span><span class="kw">=</span><span class="st">"est"</span>, <span class="kw">ss_data</span><span class="kw">=</span><span class="fl">0</span>)

<span class="co"># Run yaps to obtain estimated track</span>
<span class="no">yaps_out_ssu1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/runYaps.html">runYaps</a></span>(<span class="no">inp_ssu1</span>, <span class="kw">silent</span><span class="kw">=</span><span class="fl">TRUE</span>)

<span class="co"># plot the estimated track</span>
<span class="fu"><a href="reference/plotYaps.html">plotYaps</a></span>(<span class="kw">inp</span><span class="kw">=</span><span class="no">inp_ssu1</span>, <span class="kw">yaps_out</span><span class="kw">=</span><span class="no">yaps_out_ssu1</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"map"</span>)
<span class="co"># Add gps track for direct comparison</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">utm_y</span>~<span class="no">utm_x</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">ssu1</span>$<span class="no">gps</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mfrow</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">1</span>))
<span class="fu"><a href="reference/plotYaps.html">plotYaps</a></span>(<span class="kw">inp</span><span class="kw">=</span><span class="no">inp_ssu1</span>, <span class="kw">yaps_out</span><span class="kw">=</span><span class="no">yaps_out_ssu1</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"coord_X"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">utm_x</span>~<span class="no">ts</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">ssu1</span>$<span class="no">gps</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="reference/plotYaps.html">plotYaps</a></span>(<span class="kw">inp</span><span class="kw">=</span><span class="no">inp_ssu1</span>, <span class="kw">yaps_out</span><span class="kw">=</span><span class="no">yaps_out_ssu1</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"coord_Y"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">utm_y</span>~<span class="no">ts</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">ssu1</span>$<span class="no">gps</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>)</pre></div>
<div id="example-using-yaps-on-simulated-data" class="section level3">
<h3 class="hasAnchor">
<a href="#example-using-yaps-on-simulated-data" class="anchor"></a>Example using YAPS on simulated data</h3>
<div class="sourceCode" id="cb3"><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"baktoft/yaps"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">list</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>())
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">yaps</span>)

<span class="co"># Simulate true track of animal movement of n seconds</span>
<span class="no">trueTrack</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/simTrueTrack.html">simTrueTrack</a></span>(<span class="kw">model</span><span class="kw">=</span><span class="st">'crw'</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="fl">15000</span>, <span class="kw">deltaTime</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">shape</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">scale</span><span class="kw">=</span><span class="fl">0.5</span>, <span class="kw">addDielPattern</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">ss</span><span class="kw">=</span><span class="st">'rw'</span>)

<span class="co"># Simulate telemetry observations from true track.</span>
<span class="co"># Format and parameters depend on type of transmitter burst interval (BI) - stable (sbi) or random (rbi).</span>
<span class="no">pingType</span> <span class="kw">&lt;-</span> <span class="st">'sbi'</span>

<span class="kw">if</span>(<span class="no">pingType</span> <span class="kw">==</span> <span class="st">'sbi'</span>) { <span class="co"># stable BI</span>
    <span class="no">sbi_mean</span> <span class="kw">&lt;-</span> <span class="fl">30</span>; <span class="no">sbi_sd</span> <span class="kw">&lt;-</span> <span class="fl">1e-4</span>;
    <span class="no">teleTrack</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/simTelemetryTrack.html">simTelemetryTrack</a></span>(<span class="no">trueTrack</span>, <span class="kw">pingType</span><span class="kw">=</span><span class="no">pingType</span>, <span class="kw">sbi_mean</span><span class="kw">=</span><span class="no">sbi_mean</span>, <span class="kw">sbi_sd</span><span class="kw">=</span><span class="no">sbi_sd</span>)
} <span class="kw">else</span> <span class="kw">if</span>(<span class="no">pingType</span> <span class="kw">==</span> <span class="st">'rbi'</span>){ <span class="co"># random BI</span>
    <span class="no">pingType</span> <span class="kw">&lt;-</span> <span class="st">'rbi'</span>; <span class="no">rbi_min</span> <span class="kw">&lt;-</span> <span class="fl">20</span>; <span class="no">rbi_max</span> <span class="kw">&lt;-</span> <span class="fl">40</span>;
    <span class="no">teleTrack</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/simTelemetryTrack.html">simTelemetryTrack</a></span>(<span class="no">trueTrack</span>, <span class="kw">pingType</span><span class="kw">=</span><span class="no">pingType</span>, <span class="kw">rbi_min</span><span class="kw">=</span><span class="no">rbi_min</span>, <span class="kw">rbi_max</span><span class="kw">=</span><span class="no">rbi_max</span>)
}

<span class="co"># Simulate hydrophone array</span>
<span class="no">hydros</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/simHydros.html">simHydros</a></span>(<span class="kw">auto</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">trueTrack</span><span class="kw">=</span><span class="no">trueTrack</span>)
<span class="no">toa_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/simToa.html">simToa</a></span>(<span class="no">teleTrack</span>, <span class="no">hydros</span>, <span class="no">pingType</span>, <span class="kw">sigmaToa</span><span class="kw">=</span><span class="fl">1e-4</span>, <span class="kw">pNA</span><span class="kw">=</span><span class="fl">0.25</span>, <span class="kw">pMP</span><span class="kw">=</span><span class="fl">0.01</span>)
<span class="no">toa</span> <span class="kw">&lt;-</span> <span class="no">toa_list</span>$<span class="no">toa</span>

<span class="co"># Specify whether to use ss_data from measured water temperature (ss_data_what &lt;- 'data') or to estimate ss in the model (ss_data_what &lt;- 'est')</span>
<span class="no">ss_data_what</span> <span class="kw">&lt;-</span> <span class="st">'data'</span>
<span class="kw">if</span>(<span class="no">ss_data_what</span> <span class="kw">==</span> <span class="st">'data'</span>) {<span class="no">ss_data</span> <span class="kw">&lt;-</span> <span class="no">teleTrack</span>$<span class="no">ss</span>} <span class="kw">else</span> {<span class="no">ss_data</span> <span class="kw">&lt;-</span> <span class="fl">0</span>}


<span class="kw">if</span>(<span class="no">pingType</span> <span class="kw">==</span> <span class="st">'sbi'</span>){
    <span class="no">inp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/getInp.html">getInp</a></span>(<span class="no">hydros</span>, <span class="no">toa</span>, <span class="kw">E_dist</span><span class="kw">=</span><span class="st">"Mixture"</span>, <span class="kw">n_ss</span><span class="kw">=</span><span class="fl">10</span>, <span class="kw">pingType</span><span class="kw">=</span><span class="no">pingType</span>, <span class="kw">sdInits</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">ss_data_what</span><span class="kw">=</span><span class="no">ss_data_what</span>, <span class="kw">ss_data</span><span class="kw">=</span><span class="no">ss_data</span>)
} <span class="kw">else</span> <span class="kw">if</span>(<span class="no">pingType</span> <span class="kw">==</span> <span class="st">'rbi'</span>){
    <span class="no">inp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/getInp.html">getInp</a></span>(<span class="no">hydros</span>, <span class="no">toa</span>, <span class="kw">E_dist</span><span class="kw">=</span><span class="st">"Mixture"</span>, <span class="kw">n_ss</span><span class="kw">=</span><span class="fl">10</span>, <span class="kw">pingType</span><span class="kw">=</span><span class="no">pingType</span>, <span class="kw">sdInits</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">rbi_min</span><span class="kw">=</span><span class="no">rbi_min</span>, <span class="kw">rbi_max</span><span class="kw">=</span><span class="no">rbi_max</span>, <span class="kw">ss_data_what</span><span class="kw">=</span><span class="no">ss_data_what</span>, <span class="kw">ss_data</span><span class="kw">=</span><span class="no">ss_data</span>)
}
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">inp</span>)

<span class="no">pl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>()
<span class="no">maxIter</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">pingType</span><span class="kw">==</span><span class="st">"sbi"</span>, <span class="fl">500</span>, <span class="fl">5000</span>)
<span class="no">outTmb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/runYaps.html">runTmb</a></span>(<span class="no">inp</span>, <span class="kw">maxIter</span><span class="kw">=</span><span class="no">maxIter</span>, <span class="kw">getPlsd</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">getRep</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">outTmb</span>)

<span class="co"># Estimates in pl</span>
<span class="no">pl</span> <span class="kw">&lt;-</span> <span class="no">outTmb</span>$<span class="no">pl</span>
<span class="no">yaps_out</span> <span class="kw">&lt;-</span> <span class="kw pkg">data.table</span><span class="kw ns">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span>(<span class="kw">X</span><span class="kw">=</span><span class="no">pl</span>$<span class="no">X</span> + <span class="no">inp</span>$<span class="no">inp_params</span>$<span class="no">Hx0</span>, <span class="kw">Y</span><span class="kw">=</span><span class="no">pl</span>$<span class="no">Y</span> + <span class="no">inp</span>$<span class="no">inp_params</span>$<span class="no">Hy0</span>)

<span class="co"># Error estimates in plsd</span>
<span class="no">plsd</span> <span class="kw">&lt;-</span> <span class="no">outTmb</span>$<span class="no">plsd</span>

<span class="co"># plot the resulting estimated track</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">y</span>~<span class="no">x</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">trueTrack</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"l"</span>, <span class="kw">xlim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">hydros</span>$<span class="no">hx</span>), <span class="kw">ylim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">hydros</span>$<span class="no">hy</span>), <span class="kw">asp</span><span class="kw">=</span><span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">y</span>~<span class="no">x</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">teleTrack</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="no">hy</span>~<span class="no">hx</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">hydros</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"green"</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">20</span>, <span class="kw">cex</span><span class="kw">=</span><span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="no">Y</span>~<span class="no">X</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">yaps_out</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"red"</span>)</pre></div>
</div>
</div>
</div>
<div id="papers-using-yaps" class="section level1">
<h1 class="hasAnchor">
<a href="#papers-using-yaps" class="anchor"></a>Papers using YAPS</h1>
<div id="2019" class="section level2">
<h2 class="hasAnchor">
<a href="#2019" class="anchor"></a>2019</h2>
<ul>
<li><p>Baktoft, H., Gjelland, K.Ø., Økland, F., Rehage, J.S., Rodemann, J.R., Corujo, R.S., Viadero, N., Thygesen, U.H. (2019). Opening the black box of fish tracking using acoustic telemetry bioRxiv 2019.12.16.877688; doi: <a href="https://doi.org/10.1101/2019.12.16.877688" class="uri">https://doi.org/10.1101/2019.12.16.877688</a></p></li>
<li><p>Silva, A.T., Bærum, K.M., Hedger, R.D., Baktoft, H., Fjeldstad, H., Gjelland, K.Ø., Økland, F. Forseth, T. (2019). Science of the Total Environment The effects of hydrodynamics on the three-dimensional downstream migratory movement of Atlantic salmon. Science of the Total Environment, 135773. <a href="https://doi.org/10.1016/j.scitotenv.2019.135773" class="uri">https://doi.org/10.1016/j.scitotenv.2019.135773</a></p></li>
<li><p>Szabo-Meszaros, M., Forseth, T., Baktoft, H., Fjeldstad, H.-P., Silva, A.T., Gjelland, K.Ø., Økland, F., Uglem, I., Alfredsen, K. (2019). Modelling mitigation measures for smolt migration at dammed river sections. Ecohydrology, e2131. <a href="https://doi.org/10.1002/eco.2131" class="uri">https://doi.org/10.1002/eco.2131</a></p></li>
</ul>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/baktoft/yaps/">https://​github.com/​baktoft/​yaps/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/baktoft/yaps/issues">https://​github.com/​baktoft/​yaps/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing yaps</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Henrik Baktoft <br><small class="roles"> Maintainer, author </small>  </li>
<li>Karl Gjelland <br><small class="roles"> Author </small>  </li>
<li>Uffe H. Thygesen <br><small class="roles"> Author </small>  </li>
<li>Finn Økland <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Henrik Baktoft, Karl Gjelland, Uffe H. Thygesen, Finn Økland.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
